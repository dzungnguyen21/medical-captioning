# Configuration for General Domain Training
# MS-COCO Dataset

# ================== DATA CONFIGURATION ==================
data:
  dataset_name: "coco"
  data_dir: "./data/COCO"
  image_dir: "./data/COCO/images"
  caption_file: "./data/COCO/dataset_coco.json"
  
  # Data splits
  train_split: "train"
  val_split: "val"
  test_split: "test"
  
  # Preprocessing
  max_seq_len: 50
  min_word_freq: 5
  
  # Visual Genome (for region pre-training)
  vg_data_dir: "./data/VisualGenome"
  vg_region_file: "./data/VisualGenome/region_features.h5"

# ================== MODEL CONFIGURATION ==================
model:
  # Region Encoder
  region_encoder:
    type: "faster_rcnn"
    pretrained: true
    num_regions: 36
    feature_dim: 2048
    conf_threshold: 0.5
    nms_threshold: 0.5
  
  # Transformer Decoder
  decoder:
    d_model: 512
    num_heads: 8
    num_layers: 6
    d_ff: 2048
    dropout: 0.1
    max_seq_len: 50

# ================== TRAINING CONFIGURATION ==================
training:
  # Phase 1: Supervised (Cross-Entropy)
  supervised:
    epochs: 30
    batch_size: 32
    learning_rate: 5.0e-4
    weight_decay: 1.0e-5
    label_smoothing: 0.1
    
    # Optimization
    optimizer: "adam"
    grad_clip: 5.0
    
    # Learning rate scheduling
    scheduler: "step"
    lr_decay_step: 5
    lr_decay_gamma: 0.8
  
  # Phase 2: Reinforcement Learning (SCST)
  reinforcement:
    epochs: 20
    batch_size: 32
    learning_rate: 1.0e-5
    weight_decay: 1.0e-6
    
    # Reward function weights
    reward_cider_weight: 1.0
    reward_chair_weight: 1.0
    
    # RL-specific
    baseline_type: "greedy"  # or "average"
    entropy_weight: 0.01
    
    # Optimization
    optimizer: "adam"
    grad_clip: 5.0

# ================== EVALUATION CONFIGURATION ==================
evaluation:
  batch_size: 32
  beam_size: 3
  
  # Metrics to compute
  metrics:
    - "BLEU"
    - "METEOR"
    - "ROUGE_L"
    - "CIDEr"
    - "SPICE"
    - "CHAIR"
    - "POPE"
  
  # Visualization
  visualize_attention: true
  num_visualize_samples: 20

# ================== SYSTEM CONFIGURATION ==================
system:
  device: "cuda"
  num_workers: 4
  pin_memory: true
  seed: 42
  
  # Checkpointing
  checkpoint_dir: "./checkpoints/general"
  save_every_n_epochs: 5
  keep_n_checkpoints: 3
  
  # Logging
  log_dir: "./logs/general"
  log_every_n_steps: 100
  use_wandb: false
  wandb_project: "image-captioning-general"

# ================== INFERENCE CONFIGURATION ==================
inference:
  checkpoint_path: "./checkpoints/general/best_rl_model.pth"
  beam_size: 3
  max_length: 50
  temperature: 1.0
  top_k: null
  top_p: null
